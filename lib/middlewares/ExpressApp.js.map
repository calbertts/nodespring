{"version":3,"sources":["../../src/middlewares/ExpressApp.js"],"names":[],"mappings":"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","file":"ExpressApp.js","sourcesContent":["/**\n * Express Middleware\n * @author calbertts\n */\n\nimport NodeSpringApp from '../core/NodeSpringApp'\nimport NodeSpringUtil from '../core/NodeSpringUtil'\nimport express from 'express'\nimport http from 'http'\n\n\nexport default class ExpressApp extends NodeSpringApp {\n\n  constructor(config) {\n    super(config)\n\n    this.socketListeners = {}\n    this.configExpressApp()\n  }\n\n  bindURL(method, url, callback) {\n    this.expressApp[method](url, callback)\n  }\n\n  addSocketListeners(namespace, socketListeners, instance) {\n    socketListeners.forEach((socketListenerData) => {\n      if(namespace in this.socketListeners) {\n        this.socketListeners[namespace].instance = instance\n        this.socketListeners[namespace].events[socketListenerData.eventName] = instance[socketListenerData.methodName]\n      } else {\n        this.socketListeners[namespace] = {\n          instance: instance,\n          events: {\n            [socketListenerData.eventName]: instance[socketListenerData.methodName]\n          }\n        }\n      }\n    })\n  }\n\n  getRequestParams(request, callback) {\n    let clientData = request.body || request.query\n    callback(clientData)\n  }\n\n  setContentTypeResponse(response, contentType) {\n    response.contentType(contentType || 'text/html')\n  }\n\n  sendJSONResponse(response, data) {\n    response.json(data)\n  }\n\n  sendDataResponse(response, data) {\n    response.send(data)\n  }\n\n  configExpressApp() {\n    const port = this.config.port\n    this.expressApp = express()\n\n    this.server = http.createServer(this.expressApp)\n\n    this.bindURL('get', '/', (req, res) => {\n      res.send('Hello World!');\n    })\n\n    this.server.listen(port, () => {\n      NodeSpringUtil.log('Server running at http://localhost:5000')\n    })\n  }\n\n  configureSocketListeners() {\n    this.io = require('socket.io')(this.server)\n\n    let socketListeners = this.socketListeners\n\n    for(let namespace in socketListeners) {\n      let namespaceData = socketListeners[namespace]\n      let scope = this.io.of(namespace)\n      namespaceData.instance.clientsNamespace = scope\n\n      scope.on('connection', (socket) => {\n        if('onConnection' in namespaceData.instance) {\n          namespaceData.instance.onConnection(socket, scope)\n        }\n\n        for(let eventName in namespaceData.events) {\n          socket.on(eventName, (data) => {\n            let instance = namespaceData.instance\n            let method = namespaceData.events[eventName]\n\n            method.call(instance, data, socket, scope)\n          })\n        }\n      })\n    }\n  }\n}"]}